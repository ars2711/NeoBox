{% extends "layout.html" %} {% block main %}
<h2>White Noise Generator</h2>
<div class="mb-3">
  <button class="btn btn-primary me-2" onclick="playNoise('white')">
    White Noise
  </button>
  <button class="btn btn-secondary me-2" onclick="playNoise('pink')">
    Pink Noise
  </button>
  <button class="btn btn-warning me-2" onclick="playNoise('brown')">
    Brown Noise
  </button>
  <button class="btn btn-danger" onclick="stopNoise()">Stop</button>
</div>
<div class="alert alert-secondary">
  <small
    >Noise is generated in-browser using the Web Audio API. No downloads
    required.</small
  >
</div>
<script>
  let audioCtx, noiseNode;
  function playNoise(type) {
    stopNoise();
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let bufferSize = 2 * audioCtx.sampleRate,
      noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate),
      output = noiseBuffer.getChannelData(0);
    if (type === "white") {
      for (let i = 0; i < bufferSize; i++) output[i] = Math.random() * 2 - 1;
    } else if (type === "pink") {
      let b0 = 0,
        b1 = 0,
        b2 = 0,
        b3 = 0,
        b4 = 0,
        b5 = 0,
        b6 = 0;
      for (let i = 0; i < bufferSize; i++) {
        let white = Math.random() * 2 - 1;
        b0 = 0.99886 * b0 + white * 0.0555179;
        b1 = 0.99332 * b1 + white * 0.0750759;
        b2 = 0.969 * b2 + white * 0.153852;
        b3 = 0.8665 * b3 + white * 0.3104856;
        b4 = 0.55 * b4 + white * 0.5329522;
        b5 = -0.7616 * b5 - white * 0.016898;
        output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;
        output[i] *= 0.11;
        b6 = white * 0.115926;
      }
    } else if (type === "brown") {
      let lastOut = 0.0;
      for (let i = 0; i < bufferSize; i++) {
        let white = Math.random() * 2 - 1;
        output[i] = (lastOut + 0.02 * white) / 1.02;
        lastOut = output[i];
        output[i] *= 3.5;
      }
    }
    noiseNode = audioCtx.createBufferSource();
    noiseNode.buffer = noiseBuffer;
    noiseNode.loop = true;
    noiseNode.connect(audioCtx.destination);
    noiseNode.start(0);
  }
  function stopNoise() {
    if (noiseNode) {
      noiseNode.stop();
      noiseNode.disconnect();
      noiseNode = null;
    }
    if (audioCtx) {
      audioCtx.close();
      audioCtx = null;
    }
  }
</script>
{% endblock %}
